import React, { useContext, useEffect, useState } from "react";
import "./Product.css";
import Section from "../../common/Section";
import img1 from "../../Assets/image1.png";
import img2 from "../../Assets/image2.png";
import img3 from "../../Assets/image3.png";
import img4 from "../../Assets/image3.png";
import img5 from "../../Assets/image2.png";
import img6 from "../../Assets/image1.png";
import img7 from "../../Assets/image2.png";
import img8 from "../../Assets/image3.png";
import ShopModel from "./shopModel/ShopModel";
import { AuthContext } from "../auth/authContext/AuthContext";
import axios from "axios";

const Card = ({ title, img, price, des, onQuickShop }) => {
  const [isHovering, setIsHovering] = useState(false);
  const [isButtonHovering, setIsButtonHovering] = useState(false);

  return (
    <div
      className="product-card"
      onMouseEnter={() => setIsHovering(true)}
      onMouseLeave={() => setIsHovering(false)}
    >
      <div className="image-container">
        <img
          src={img || "/placeholder.svg"}
          alt={title}
          className={`product-image ${isHovering ? "zoom" : ""}`}
        />
        {/* Quick Shop button only appears on hover */}
        {isHovering && (
          <button
            className={`quick-shop-btn ${isButtonHovering ? "filling" : ""}`}
            onMouseEnter={() => setIsButtonHovering(true)}
            onMouseLeave={() => setIsButtonHovering(false)}
            onClick={() => onQuickShop({ title, img, price })}
          >
            <span className="btn-fill"></span>
            <span className="btn-text">+ QuickShop</span>
          </button>
        )}
      </div>

      <div className="product-info">
        <h1 className="product-title">{title}</h1>
        <p className="product-price">{price}</p>
        {/* {des && <p className="product-description">{des}</p>} */}
      </div>
    </div>
  );
};

export default function Product() {
  const authData = useContext(AuthContext);
  const [products, setProducts] = useState([]);
  const [selectedProduct, setSelectedProduct] = useState(null);

  const BASE_URL = "http://localhost:8010";
  useEffect(() => {
    console.log("Fetching products...");

    axios
      .get(`${BASE_URL}/products/GetProducts`, {
        headers: {
          Authorization: `Bearer ${authData?.token}`,
        },
      })
      .then((res) => {
        console.log("Response:", res.data);

        if (res.data.success) {
          const formatted = res.data.data.map((p) => ({
            ...p,
            img: `${BASE_URL}${p.image}`, // full image URL
          }));
          console.log({ formatted });
          setProducts(formatted);
        }
      })
      .catch((err) => {
        console.error("âŒ Error fetching products:", err);
      });
  }, []);

  const handleQuickShop = (product) => {
    setSelectedProduct(product);
  };

  const closeModal = () => setSelectedProduct(null);

  const products1 = [];

  return (
    <Section id="products">
      <div className="product">
        <h1 className="header">Featured Products</h1>

        <div className="product-grid">
          {products.length > 0 ? (
            products.map((product) => (
              <Card
                key={product._id}
                title={product.name}
                img={product.img}
                price={product.price}
                des={product.description}
                onQuickShop={handleQuickShop}
              />
            ))
          ) : (
            <p>Loading products...</p>
          )}

          {selectedProduct && (
            <ShopModel
              selectedProduct={selectedProduct}
              closeModal={closeModal}
            />
          )}
        </div>
      </div>
    </Section>
  );
}
